<?php

// Import BioStor references and add to CouchDB

require_once (dirname(__FILE__) . '/config.inc.php');
require_once (dirname(__FILE__) . '/couchsimple.php');
require_once (dirname(__FILE__) . '/lib.php');


//--------------------------------------------------------------------------------------------------
/**
 * @brief Create a citation string for indexing
 * *
 * @param reference Reference object to be encoded
 *
 * @return OpenURL
 */
function reference_to_citation_string($reference)
{
	$citation = '';
	
	//echo "citation=$citation\n";
	if (isset($reference->author))
	{
		$authors = array();
		foreach ($reference->author as $author)
		{
			if (isset($author->forename) && isset($author->lastname))
			{
				$authors[] = $author->lastname . ' ' . $author->forename;
			}
			else
			{
				$authors[] = $author->name;
			}
		
		}
		$citation .= join(', ', $authors);
		$citation .= ' ';
	}
	//echo "citation=$citation\n";
	
	
	if (isset($reference->year))
	{
		$citation .= '(' . $reference->year . ')';
	}
	
	if (isset($reference->title))
	{
		$citation .= ' ' . $reference->title . '.';
	}
	//echo "citation=$citation\n";
	
	
	if (isset($reference->journal))
	{
		$citation .= ' ' . $reference->journal->name;
		if (isset($reference->journal->volume))
		{
			$citation .= ', ' . $reference->journal->volume;
		}
		if (isset($reference->journal->issue))
		{
			$citation .= '(' . $reference->journal->issue . ')';
		}		
		if (isset($reference->journal->pages))
		{
			$citation .= ': ' . $reference->journal->pages;
		}
	}
	else
	{
		// not a journal...
		$citation .= ': ' . $reference->pages;		
	}
	
	//echo "citation=$citation\n";

	return $citation;
}



$biostor = 'http://localhost/~rpage/biostor-classic/www'; 


$ids=array(

157338,
157342,
157331,
157329,
157339,
157335,
157337,
157322,
157324,
157328,
157334,
157336,
157340,
157323,
157333,
157345,
157326,
157327,
157321,
157325,
157320,
157344,
157343,
157332,
157330,
157388,
157386,
157369,
157370,
157366,
157367,
157368,
157384,
157382,
157374,
157375,
157379,
157378,
157403,
157400,
157410,
157407,
157406,
157408,
157409,
157404,
157405,
157411,
157380,
157387,
157393,
157390,
157389,
157395,
157381,
157385,
157383,
157347,
157346,
157348,
157350,
157351,
157349,
157353,
157352,
157341,
157358,
157359,
157360,
157362,
157363,
157364,
157365,
157356,
157357,
157361,
157355,
157354,
157391,
157396,
157397,
157394,
157392,
157427,
157428,
157426,
157398,
157402,
157401,
157399,
157415,
157412,
157413,
157414,
157416,
157377,
157373,
157371,
157372,
157376,
157420,
157421,
157422,
157423,
157424,
157425,
157417,
157418,
157419,
157158,
157157,
157152,
157162,
157150,
157159,
157161,
157139,
157138,
157143,
157145,
157140,
157257,
157258,
157253,
157250,
157248,
157220,
157207,
157208,
157205,
157191,
157256,
157211,
157243,
157219,
157212,
157251,
157142,
157127,
157128,
157129,
157134,
157149,
157141,
157198,
157196,
157195,
157183,
157176,
157168,
157169,
157171,
157166,
157199,
157200,
157194,
157184,
157197,
157175,
157181,
157114,
157113,
157115,
157106,
157103,
157104,
157100,
157099,
157098,
157096,
157111,
157110,
157107,
157108,
157109,
157101,
157097,
157112,
157255,
157213,
157278,
157260,
157252,
157151,
157154,
157120,
157126,
157187,
157178,
157189,
157188,
157190,
157186,
157135,
157179,
157177,
157130,
157123,
157116,
157122,
157125,
157117,
157105,
157131,
157118,
157102,
157132,
157167,
157180,
157146,
157119,
157121,
157133,
157124,
63678,
72350,
71239,
71227,
71238,
71240,
71247,
71248,
71237,
71235,
71236,
71230,
71234,
71231,
71233,
71232,
71224,
99079,
236809,
249351,
13219,
59220,
120756,
120761,
120749,
120758,
120755,
120769,
130766,
130371,
130695,
130694,
130594,
130595,
130596,
130591,
130592,
130593,
130590,
130587,
130588,
130589,
130584,
130585,
130586,
130581,
130582,
130583,
130577,
130578,
130579,
130580,
130573,
130574,
130575,
130576,
130570,
130571,
130572,
130569,
130555,
130554,
130550,
130528,
127928,
127973,
120726,
130619,
130600,
130597,
130601,
120763,
130475,
130489,
130476,
130477,
130478,
130458,
130453,
130054,
120760,
120764,
60084,
120745,
120751,
120771,
120750,
120748,
128055,
127993,
127994,
127995,
13223,
94220,
94232,
94235,
94237,
94276,
94275,
94256,
94249,
94227,
94239,
94255,
94251,
94253,
94225,
94274,
94238,
94226,
94273,
94234,
89822,
89819,
89811,
89794,
89753,
89758,
89802,
89790,
89755,
89798,
89786,
89810,
89799,
89756,
89806,
89787,
89791,
89826,
89814,
89824,
89818,
89820,
89816,
89804,
89808,
89803,
89825,
89809,
89795,
89813,
89789,
89796,
89757,
89800,
89812,
89805,
89792,
89793,
89784,
89754,
89815,
89823,
89785,
89759,
89797,
89807,
89788,
89821,
90139,
90245,
90248,
90137,
90251,
90259,
90129,
90250,
90256,
90262,
90263,
90261,
90138,
90257,
90246,
90252,
90258,
90141,
81491,
81537,
81492,
81546,
81543,
81544,
81545,
81540,
81541,
81542,
81548,
81547,
81538,
81539,
81493,
81549,
81550,
90244,
90243,
90253,
90249,
90128,
90241,
90265,
90135,
90134,
90130,
90247,
90131,
90133,
90136,
90260,
90242,
90254,
90140,
89106,
89055,
89094,
89095,
88990,
89074,
89093,
89105,
81559,
81560,
93263,
90628,
89286,
90627,
90633,
90631,
89288,
90625,
89290,
90624,
94127,
94065,
94070,
89444,
93996,
94084,
94119,
94181,
94129,
94168,
94122,
94113,
94057,
94076,
71810,
93997,
94060,
94082,
94067,
94075,
94066,
94069,
94078,
94177,
94074,
94183,
94207,
94187,
93998,
94200,
94155,
94136,
94202,
94097,
94151,
94180,
94204,
94135,
94085,
94162,
94121,
94086,
90069,
90126,
90082,
90118,
90059,
90114,
90035,
90071,
90075,
90054,
90084,
90119,
90088,
90124,
90041,
90078,
90036,
90030,
90086,
90123,
90025,
90034,
90031,
90108,
90027,
90074,
90127,
90089,
90037,
90055,
90058,
90073,
90029,
90068,
13202,
81553,
81552,
81551,
90325,
90324,
94384,
94385,
94379,
94380,
95092,
72378,
89746,
89743,
89713,
89711,
89712,
89744,
89729,
89750,
89730,
89745,
89752,
90621,
90623,
90629,
90630,
89289,
90634,
89287,
90626,
90632,
89291,
81625,
81490,
94071,
94077,
94083,
94068,
94064,
93999,
89447,
94061,
94080,
94063,
94081,
94079,
94000,
94062,
94073,
90113,
94231,
94229,
94218,
94233,
94236,
13205,
89751,
94383,
94381,
89710,
81508,
81598,
81600,
81555,
81554,
81513,
81556,
81557,
81558,
90033,
90125,
90087,
90032,
90077,
90070,
90040,
90026,
90072,
90056,
90116,
90039,
90051,
90085,
90117,
90076,
90038,
90052,
90112,
90043,
90067,
90081,
90053,
90115,
90080,
90042,
90120,
90057,
81562,
81561,
81563,
81564,
81565,
94087,
94188,
94092,
94141,
94099,
94107,
94146,
94159,
94192,
94154,
94101,
94199,
94150,
94137,
94194,
94140,
94125,
94190,
94143,
94157,
94111,
94112,
94131,
94182,
94195,
94123,
94165,
94208,
94193,
94185,
94197,
94128,
94109,
94201,
94203,
94105,
94158,
94196,
89197,
89192,
89157,
89155,
89151,
89191,
89161,
89195,
89194,
89160,
89159,
89156,
89196,
89158,
89190,
89198,
89153,
89154,
89152,
89199,
89096,
89103,
89056,
89102,
89085,
89092,
89104,
81494,
90455,
249153,
99274,
99275,
99276,
65142,
99077,
99078,
99286,
99284,
99287,
99281,
99283,
13208,
98159,
99285,
99282,
99273,
99277,
94221,
94269,
94240,
94241,
94120,
94149,
94184,
94108,
94144,
94164,
94163,
94198,
94133,
94189,
94132,
94139,
94148,
94124,
94178,
94156,
94118,
94116,
94088,
94272,
94230,
94277,
94271,
94161,
94268,
94219,
94359,
94228,
94250,
94130,
94091,
94142,
94100,
94114,
94126,
94167,
94138,
94098,
94191,
94186,
94160,
94205,
94166,
94179,
94106,
94153,
94145,
94147,
94117,
126621,
126625,
126632,
126636,
59644,
65118,
133198,
127600,
13210,
97484,
95648,
97487,
85248,
59154,
95546,
95544,
95543,
81501,
81515,
81614,
81516,
81482,
81576,
133192,
81590,
131895,
120746,
613,
97486,
249146,
127998,
97482,
626,
130395,
120752,
120765,
71110,
99064,
128010,
13195,
120767,
120753,
61443,
59212,
207906,
133190,
207905,
99426,
127731,
160484,
65124,
127599,
239408,
239409,
239199,
239200,
239201,
239202,
239203,
239204,
239205,
239206,
239207,
239208,
239209,
239210,
239211,
239212,
239213,
239214,
239215,
239216,
239217,
239218,
239219,
239220,
239221,
239222,
239223,
239224,
239225,
239226,
239227,
239228,
239229,
239230,
239231,
239232,
239233,
239234,
52826,
52827,
239566,
119208,
239166,
239167,
239168,
239169,
239170,
239171,
239172,
239173,
239174,
239175,
239176,
239177,
239186,
239187,
239188,
239189,
239190,
239191,
239192,
239193,
239194,
239195,
239196,
239197,
239198,
239145,
239146,
239147,
239148,
239149,
239150,
239151,
239154,
239155,
239156,
239157,
239158,
239159,
239160,
239161,
239162,
239163,
239164,
239165,
119190,
128107,
128108,
131896,
193939,
127968,
131392,
131393,
131391,
61786,
61787,
131092,
131093,
131094,
131095,
131086,
131087,
131088,
131089,
131090,
131091,
131078,
131071,
131072,
131073,
131074,
131076,
131590,
131591,
131592,
131593,
131594,
131595,
131171,
131174,
131175,
131176,
131177,
131159,
131160,
131161,
131162,
131163,
131164,
131165,
131166,
131167,
131168,
131170,
131150,
131151,
131152,
131153,
131154,
131155,
131157,
131158,
131144,
131145,
131146,
131147,
131148,
131149,
130991,
131224,
131225,
131216,
131217,
131218,
131219,
131220,
131221,
131222,
131223,
131178,
131179,
131180,
131181,
130875,
130876,
130877,
130878,
130874,
131142,
131133,
131134,
131135,
131130,
131131,
131132,
99069,
99066,
99070,
99068,
133199,
65146,
13201,
238919,
238920,
238921,
238922,
238923,
238924,
238925,
238926,
238927,
238928,
238929,
238930,
238931,
238932,
238933,
238934,
238935,
238936,
238937,
238938,
238939,
238940,
238941,
238942,
238943,
238944,
238904,
238905,
238906,
238907,
238908,
238909,
238910,
238911,
238912,
238913,
238914,
238915,
238916,
238917,
238918,
50367,
119207,
131373,
131374,
131372,
131371,
131369,
131368,
133201,
133193,
159379,
159948,
159620,
58278,
235594,
59257,
59254,
127999,
120768,
71277,
61788,
59213,
59217,
59258,
13244,
13245,
13246,
13247,
13248,
13308,
13309,
13310,
13311,
13274,
13275,
13276,
13277,
13278,
13279,
13280,
13281,
13282,
13283,
13298,
60557,
59158,
135531,
65126,
133205,
133204,
142933,
142928,
142923,
142922,
142629,
142564,
142563,
142652,
142632,
142950,
142945,
142944,
142949,
142943,
142951,
142948,
142946,
142942,
142947,
142918,
142917,
142559,
142653,
142993,
142995,
142991,
142999,
142996,
142990,
142997,
142992,
142998,
142994,
142965,
142969,
142968,
142966,
142970,
142963,
142967,
142962,
142964,
142936,
142656,
73365,
133191,
127991,
160489,
50135,
251321,
131616,
130675,
130671,
130643,
183964,
237408,
62413,
63604,
89950,
89971,
89874,
89979,
89972,
89951,
89953,
89981,
63601,
62750,
62752,
62441,
62249,
62442,
62088,
62450,
62414,
63337,
62457,
62756,
63592,
62446,
62094,
63617,
63284,
62569,
62406,
62228,
63602,
62096,
100938,
63441,
62230,
62570,
62251,
63600,
62422,
62423,
62424,
167517,
62090,
71815,
127553,
128012,
157429,
71913,
62407,
89848,
89851,
89980,
89978,
89954,
89975,
89849,
89952,
89976,
89974,
89850,
89973,
62454,
142313,
142108,
142281,
142282,
142664,
142294,
142291,
131799,
131797,
131798,
234785,
51251,
51247,
51249,
51250,
50440,
50441,
50442,
65067,
128000,
185384,
185425,
78495,
90727,
92005,
93544,
92906,
88422,
99076,
87213,
86697,
87281,
87270,
87274,
49199,
87366,
87367,
92907,
98161,
58810,
128036,
13222,
13200,
93762,
92908,
92028,
122366,
121013,
121879,
99427,
88742,
88976,
87263,
87266,
91126,
93549,
92022,
121014,
86827,
92180,
92179,
92031,
87256,
87388,
57260,
56644,
57046,
68888,
99288,
99265,
71811,
66191,
99071,
121880,
73369,
99065,
133202,
99289,
50333,
99072,
131894,
99073,
121015,
61159,
61160,
61161,
61162,
87247,
92910,
92905,
99272,
73368,
65145,
87365,
98821,
89193,
99075,
87268,
87271,
87276,
87261,
87273,
87278,
90028,
90083,
90079,
90090,
92177,
91721,
89450,
89446,
89451,
89448,
89453,
89449,
89551,
89493,
89552,
89556,
94115,
91723,
92004,
92621,
92827,
92040,
87245,
87254,
87282,
87097,
87130,
88450,
88424,
91725,
92027,
92006,
92174,
92826,
92521,
92183,
92167,
87253,
87272,
87512,
235793,
87251,
86982,
87259,
87094,
91720,
92009,
92019,
92161,
92820,
92204,
92572,
92590,
92168,
92629,
92021,
92042,
92178,
92815,
92176,
92029,
88451,
88448,
92589,
92600,
92016,
92024,
87985,
88972,
88646,
87083,
87095,
86698,
86773,
87212,
87214,
87249,
87252,
87277,
87091,
87105,
87063,
87103,
86772,
87248,
87098,
87786,
66415,
87788,
87790,
87749,
59235,
59246,
65952,
87793,
59240,
60700,
87805,
87794,
87807,
87808,
59242,
87811,
87745,
87784,
97647,
77749,
87795,
87796,
87797,
97651,
87801,
87803,
87800,
87750,
87751,
87753,
87754,
87757,
66416,
66418,
87783,
87780,
87779,
87759,
66402,
87765,
87767,
66401,
87764,
87768,
87769,
53335,
87771,
87773,
87775,
87776,
87777,
69661,
87778,
87747,
87787,
87789,
87791,
87748,
87792,
59241,
87804,
87806,
53329,
87809,
87810,
53330,
53336,
69685,
97649,
87782,
59245,
97652,
87799,
87802,
59244,
87752,
87756,
87758,
87744,
87785,
87755,
87760,
66404,
87761,
87766,
59215,
87746,
77750,
71308,
87763,
87770,
87772,
66412,
87774,
87781,
89557,
89494,
89548,
89549,
89492,
89554,
89555,
89550,
89553,
94382,
87262,
87258,
87279,
87325,
87260,
94110,
95094,
95095,
95093,
90781,
90728,
90779,
90716,
90729,
90718,
90731,
94254,
94270,
89868,
89977,
89883,
90688,
90686,
90684,
90682,
90691,
90680,
90678,
90683,
90679,
90689,
90681,
90685,
90690,
89455,
89443,
89456,
89452,
89457,
89458,
89445,
90722,
89801,
89817,
92007,
92596,
92654,
92046,
92030,
92003,
87246,
87092,
87264,
87100,
87106,
87129,
92597,
92822,
92047,
92333,
92414,
92023,
92753,
92209,
92032,
92825,
87089,
86826,
92601,
92614,
92062,
92025,
92045,
92026,
92823,
92175,
92036,
88449,
88973,
88643,
120754,
120744,
92615,
92623,
92293,
91918,
92038,
91828,
92210,
91726,
92012,
92613,
92041,
92048,
92035,
92043,
91919,
92034,
92207,
92061,
91722,
92044,
92620,
92824,
92199,
87084,
87265,
87280,
87088,
87102,
86699,
86704,
86981,
92569,
92602,
92033,
92622,
92818,
92018,
92064,
91829,
91724,
92162,
92570,
91917,
92819,
92172,
92008,
92166,
87086,
87242,
87275,
87099,
65144,
65123,
120747,
120762,
120727,
120766,
130490,
130479,
130480,
130481,
130482,
130483,
130484,
130493,
130492,
130491,
130473,
130474,
130469,
130470,
130471,
130472,
130465,
130466,
130467,
130460,
130462,
130463,
130464,
130456,
130457,
130459,
130452,
130454,
130455,
127867,
127970,
127971,
130497,
130498,
130494,
130495,
130496,
87267,
87090,
92017,
92181,
92165,
51777,
130372,
130373,
130369,
130370,
130368,
130391,
130392,
130393,
130394,
130298,
127923,
127927,
127926,
127924,
127925,
127929,
130623,
130620,
130621,
130622,
130618,
130615,
130616,
130617,
130612,
130613,
130614,
130608,
130609,
130610,
130611,
130606,
130607,
130602,
130603,
130604,
130605,
130598,
130599,
130699,
130700,
130698,
127948,
130696,
130697,
130693,
130690,
130691,
130692,
130676,
130677,
130678,
130679,
130680,
130672,
130673,
130674,
130665,
130666,
130667,
130668,
130669,
130661,
130662,
130663,
130664,
130655,
130656,
130657,
130658,
130659,
130651,
130652,
130653,
130654,
130647,
130648,
130649,
130650,
130642,
130644,
130645,
130636,
130632,
130633,
130634,
130635,
130924,
130921,
130922,
130923,
130919,
130920,
130918,
130670,
130917,
130915,
130916,
130913,
130914,
130911,
130912,
130909,
130910,
130907,
130908,
130905,
130906,
131602,
131603,
131601,
131600,
131599,
131597,
131596,
130225,
130226,
130227,
130228,
130222,
130223,
127950,
127949,
127951,
130738,
130739,
130740,
130733,
130734,
130781,
130845,
130846,
131619,
131620,
131617,
131618,
131613,
131614,
131610,
131611,
131612,
131604,
131605,
131607,
131608,
130173,
130171,
130172,
130168,
130169,
130170,
130152,
130153,
130036,
130037,
130038,
130035,
130030,
130031,
130032,
130033,
130028,
130009,
127898,
130749,
130750,
130780,
130779,
130776,
130777,
130778,
130767,
130768,
91719,
92361,
92595,
92208,
91920,
92010,
92653,
92816,
90725,
90724,
90778,
90723,
90730,
90780,
90719,
90717,
90721,
92039,
90720,
90815,
90726,
12538,
88645,
61103,
61104,
61105,
61106,
61107,
61108,
61109,
61110,
61111,
88974,
92909,
93543,
90066,
93545,
88447,
88336,
88423,
87057,
87093,
87104,
88975,
91916,
92202,
92599,
92037,
92520,
93943,
92571,
92591,
92011,
92203,
92817,
92206,
92164,
92163,
91915,
238439,
238426,
61156,
49615,
49708,
52824,
52825,
49862,
49863,
49864,
50096,
50097,
50098,
50099,
50100,
50101,
50102,
50103,
50104,
50105,
50106,
50107,
50108,
128033,
241217,
133598,
206590,
59715,
59718,
133679,
98734,
98736,
98737,
98735,
98741,
98743,
98742,
133681,
133680,
98740,
98744,
98739,
98747,
98745,
98738,
98746,
98756,
98757,
98748,
98749,
98750,
98751,
127996,
133682,
133599,
97483,
128282,
93541,
92205,
92598,
235151,
92049,
92182,
92173,
92821,
92020,
157237,
157238,
157247,
157249,
157244,
157245,
157254,
157239,
157240,
157241,
157242,
157236,
157227,
157224,
157231,
157228,
157226,
157230,
157229,
157223,
157234,
157232,
157267,
157263,
157271,
157288,
157284,
157272,
157273,
157275,
157289,
157292,
157305,
157302,
157307,
157306,
157299,
157294,
157300,
157313,
157310,
157312,
157311,
157308,
157298,
157295,
157301,
157304,
157261,
157264,
157274,
157270,
157283,
157281,
157277,
157265,
157269,
157262,
157286,
157303,
157282,
157285,
157279,
157309,
129836,
129835,
129834,
129833,
157153,
157266,
157297,
157314,
157315,
157317,
157316,
157319,
157296,
157144,
157155,
157318,
157221,
157137,
157147,
157156,
157164,
157163,
157148,
157136,
157218,
157210,
157206,
157204,
157203,
157185,
157192,
157193,
157225,
157216,
157235,
157233,
157201,
157202,
157209,
157214,
157259,
157291,
157287,
157276,
157215,
157246,
157222,
157217,
157268,
157170,
157172,
157173,
157174,
157182,
157165,
157160,
157293,
157280,
157290,
133570,
133559,
133560,
133561,
133562,
133545,
93546,
133571,
133572,
133573,
133574,
133575,
133576,
133558,
133537,
129878,
129873,
129874,
129875,
129876,
129877,
129763,
129764,
129762,
129829,
129926,
129927,
129928,
129929,
129930,
61072,
61073,
87244,
87255,
87269,
87087,
87243,
87257,
87408,
86824,
59197,
93542,
93547,
168592,
133171,
133170,
133169,
168587,
168588,
168589,
168590,
168591,
93459,
133164,
133163,
133165,
133166,
133167,
97480,
97485,
244612,
73373,
57193,
97488,
55631,
55632,
55633,
55630,
61042,
61043,
61044,
61046,
61047,
61048,
61050,
61051,
61052,
61053,
119206,
98759,
97479,
73246,
60083,
99425,
192178,
65109,
128034,
128105,
151207,
128056,
133374,
133375,
142493,
142499,
142957,
142952,
142956,
142953,
142955,
142954,
142980,
142979,
142982,
142983,
142981,
142978,
175175,
133427,
133426,
142474,
142478,
142638,
142592,
142585,
142572,
142122,
142124,
142026,
142014,
142742,
142279,
142276,
142250,
142203,
142069,
142308,
142305,
142235,
142736,
142730,
142190,
142158,
142163,
142056,
142004,
142021,
142137,
142228,
142229,
142232,
142231,
142025,
142058,
142691,
142542,
142370,
142319,
142323,
142102,
142145,
142144,
142167,
142727,
142267,
142046,
142047,
142051,
142693,
142207,
142029,
142677,
142687,
142188,
142131,
142135,
142127,
142130,
133481,
133484,
133485,
133479,
133480,
133482,
133483,
133486,
133487,
133488,
142810,
142747,
142199,
142197,
142753,
142218,
142217,
142214,
142215,
142789,
142760,
142783,
142146,
142148,
142082,
142409,
142399,
142420,
142423,
142154,
142921,
142919,
142920,
142491,
142434,
142431,
142454,
142222,
142678,
142766,
142243,
142070,
142038,
133225,
133226,
133224,
133502,
246650,
142380,
142377,
142378,
142391,
142389,
142346,
142344,
142345,
142340,
142355,
142608,
142433,
142430,
207779,
142506,
142509,
142508,
142817,
142813,
131893,
142091,
142093,
142120,
142121,
142716,
142713,
96362,
142511,
142516,
142820,
142823,
142504,
142502,
119209,
119204,
142838,
142541,
142651,
142650,
142976,
142974,
142972,
142973,
142977,
142975,
142971,
142588,
142574,
142587,
142570,
142565,
142553,
142555,
142834,
142832,
142527,
142533,
142524,
142528,
235586,
80092,
272031,
87812,
87798,
87762,
81617,
81623,
81502,
133162,
142986,
142989,
142985,
142984,
142988,
142987,
142959,
142958,
142961,
142960,
69151,
81512,
81679,
81680,
69069,
81486,
95788,
81519,
81616,
81599,
81678,
81628,
75821,
81518,
81626,
81505,
81620,
81621,
81511,
81627,
81487,
81507,
71209,
81624,
81476,
81618,
81597,
74146,
74145,
81474,
81586,
81584,
81587,
81585,
81588,
81583,
81475,
81509,
81619,
69058,
81489,
66049,
70091,
70092,
71915,
71916,
98760,
101090,
68442,
68443,
133195,
68434,
68282,
68439,
68283,
68755,
68756,
236998,
68449,
68437,
68438,
68502,
68285,
68430,
68432,
68466,
68284,
68467,
68441,
73371,
68440,
68431,
68444,
68445,
68758,
68436,
68716,
68281,
68446,
68447,
68753,
68754,
68433,
68757,
68448,
68715,
133200,
133389,
133388,
133390,
207909,
207908,
207907,
207911,
207910,
81503,
81504,
81485,
81484,
81517,
142332,
81510,
81252,
207919,
129842,
129841,
129840,
129831,
129839,
129838,
129837,
129830,
129843,
129844,
129832,
129847,
128054,
235782,
129631,
142459,
142461,
128098,
133206,
134966,
140852,
133194,
127988,
127987,
206639,
219012,
219023,
133878,
133879,
133880,
133881,
133882,
133883,
133884,
133885,
133886,
133889,
133843,
133844,
133744,
160664,
133746,
128097,
128096,
147546,
147547,
147554,
147555,
260062,
248050,
260077,
127986,
127985,
260070,
127972,
166841,
128011,
128959,
160491,
128956,
128962,
128958,
113578,
128961,
128955,
114697,
128379,
127992,
128031,
128037,
128032,
115273,
128158,
128157,
133203,
128102,
127997,
128109,
128110,
128111,
128273,
128272,
128271,
128270,
128258,
128260,
128957,
128960,
133256,
142715,
142706,
142161,
128502,
128506,
128500,
128501,
128844,
128505,
128504,
128503,
128871,
128872,
133039,
133034,
133035,
133036,
133037,
133038,
133029,
133030,
133031,
133032,
133033,
133021,
133022,
133026,
133027,
133028,
129414,
129364,
232953,
133009,
133010,
133011,
133012,
133013,
133014,
133015,
133016,
133017,
133018,
133019,
133020,
133006,
133007,
133008,
133005,
132839,
132842,
132845,
132829,
132360,
132370,
132403,
132404,
132359,
132406,
132364,
132363,
132366,
132368,
132361,
132362,
132367,
132365,
132369,
131954,
131962,
240366,
248325,
248388,
147727,
231958,
146731,
146703,
135712,
151439,
147598,
147586,
167070,
161483,
253377,
242301,
168652,
168761,
226593,
226596,
226597,
226598,
226571,
226577,
226600,
226603,
226609,
226610,
226611,
226612,
226621,
226554,
226561,
166594,
226639,
242195,
242187,
169945,
172224,
234911,
226368,
198666,
232043,
232045,
232049,
232050,
232051,
232052,
232053,
232054,
232055,
232056,
232057,
232059,
231998,
231999,
232000,
232001,
232002,
232003,
232004,
232005,
232008,
232013,
232020,
232029,
201301,
201649,
207279,
234809,
208974,
208972,
208969,
208968,
208979,
208977,
208971,
208967,
208978,
208976,
208975,
208973,
208970,
223196,
217497,
217156,
217547,
251315,
224821,
224781,
224783,
224766,
232616,
236975,
234584,
234585,
234586,
234587,
234588,
234589,
234590,
241901,
239720,
239721,
239730,
241206,
241226,
241292,
241293,
241294,
241295,
241308,
241296,
241297,
241298,
241299,
241300,
241309,
241301,
241302,
241303,
241304,
241305,
241310,
241306,
241307,
241311,
241312,
241313,
241314,
241315,
241316,
241317,
241318,
241319,
241320,
241321,
241322,
241323,
241324,
241325,
244352,
244351,
243415,
245132,
246442,
245466,
252688,
246763,
249075,
249074,
249073,
249189,
249171,
249196,
249579,
249582,
249921,
249927,
250346,
250511,
250502,
251094,
256543,
260965,
252430,
252556,
257243,
260711,

);


//for ($id = $start; $id <= $end; $id++)
foreach ($ids as $id)
{
	$json = get($biostor . '/reference/' . $id . '.bibjson');
	
	if ($json != '')
	{
		$reference = json_decode($json);
		
		if ($reference)
		{
			// ignore stuff tnot linked to BHL
			$go = true;
			
			if ($reference->link)
			{
				foreach ($reference->link as $link)
				{
					if ($link->url == 'http://www.biodiversitylibrary.org/page/0')
					{
						$go = false;
					}
				}
			}
			
			if ($go)
			{			
				$reference->_id = 'biostor/' . $id;
				
				$reference->citation = reference_to_citation_string($reference);	
				
				// thumbnail
				$url = $biostor . '/reference/' . $id . '.json';
				$json = get($url);
				
				if ($json != '')
				{				
					$obj = json_decode($json);
					
					// thumbnail
					$reference->thumbnail = $obj->thumbnails[0];
					
					// date
					if (isset($obj->date))
					{
						$reference->date = array();
						if (preg_match('/(?<year>[0-9]{4})/', $obj->date, $m))
						{
							$reference->date[] = (Integer)$m['year'];
						}
						if (preg_match('/(?<year>[0-9]{4})-(?<month>\d+)/', $obj->date, $m))
						{
							$month = preg_replace('/^0+/', '', $m['month']);
							if ($month != '')
							{
								$reference->date[] = (Integer)$month;
							}
						}
						if (preg_match('/(?<year>[0-9]{4})\-(?<month>\d+)\-(?<day>\d+)$/', $obj->date, $m))
						{
							$day = preg_replace('/^0+/', '', $m['day']);
							if ($day != '')
							{
								$reference->date[] = (Integer)$day;
							}
						}
							
					}		
										
					// names
					if (isset($obj->names))
					{
						$reference->names = $obj->names;
					}		
					
					// classification
					if (isset($obj->expanded))
					{
						$reference->classification = $obj->expanded;
					}
					
				}
				
				print_r($reference);
				
				$couch->add_update_or_delete_document($reference,  $reference->_id);
			}
		}		
	}
}

?>